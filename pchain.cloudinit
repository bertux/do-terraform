#cloud-config
users:
  - name: pchain
    groups: sudo
    shell: /bin/bash
    sudo: ['ALL=(ALL) NOPASSWD:ALL']
    ssh-authorized-keys:
      - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDDkGnSpesdmXv2cDnwusdnzaImJePFLfdNTdXqrO83ii7E5bVVR/sL0eXHmCIyAwAW7KxkLJisqy6Lw+6SZhYK/TrktHwEDfutm7fZwR7PLa98mKHm+SX5LT5t72AyXk4eE9rCyRNJnaTU+NqBgnfF0kglOA47gD3OpWd0GVE00UbPBlWH3JYvz3SSjEU2zd9Rq0BhUlYPSoxqAEL536hVbmUYo+RiReXZaCYDf5msEDf2BS/HZSvQMDKAZfJ1KWkDE/1ZSAdtt8MAAYNmt1unypyXRGPgOyrdqxKXHzih1yjDIw1+LsQhcxY/XE2WB4mHQqZfT1LNy1untLBD2vRR bert@pchain
packages:
  - git
  - unzip
  - jq
runcmd:
  - mkdir -p /home/pchain/bin
  - mkdir -p /home/pchain/src
  - cd /home/pchain/src
  - wget https://github.com/bertux/do-terraform/raw/master/pchain.service
  - cp pchain.service /etc/systemd/system/pchain.service
  - wget https://github.com/pchain-org/pchain/releases/download/pre-release/pchain_init_dirs.zip
  - unzip pchain_init_dirs.zip
  - mv pchain_init_dirs/pchain/.pchain /home/pchain/
  - mv pchain_init_dirs/pchain/bin/pchain /home/pchain/bin/
  - mv pchain_init_dirs/pchain/log /home/pchain/
  - rm -rf pchain_init_dirs
  - cd /home/pchain
  - chmod +x bin/pchain
  - ./bin/pchain -datadir .pchain init .pchain/pchain/eth_genesis.json
  - chmod -R 777 .pchain/*
  - ./bin/pchain -datadir .pchainDevAccount init_eth_genesis "{10000000000000000000000000000000000, 100}"
  - chmod -R 777 .pchainDevAccount/*
  - cp .pchainDevAccount/pchain/priv_validator.json .pchain/pchain/
  - cp -r .pchainDevAccount/pchain/keystore .pchain/pchain/
  - chown -R pchain: /home/pchain/
  - systemctl enable pchain
  - systemctl start pchain
